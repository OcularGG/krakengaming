(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7256],{400:(e,t,a)=>{Promise.resolve().then(a.bind(a,4739))},4739:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>o});var s=a(7573),r=a(7653),l=a(7754),n=a(140),i=a(7659);let c=e=>{let{src:t,alt:a,className:l="",onError:n}=e,[i,c]=(0,r.useState)(null),[o,d]=(0,r.useState)(!0);return(0,r.useEffect)(()=>{let e=new Image;e.onload=()=>{c(t),d(!1)},e.onerror=()=>{d(!1),n&&n()},e.src=t},[t,n]),(0,s.jsxs)("div",{className:"".concat(l," relative"),children:[o&&(0,s.jsx)("div",{className:"absolute inset-0 bg-navy-dark/10 animate-pulse flex items-center justify-center",children:(0,s.jsx)("div",{className:"text-navy-dark",children:"⚓"})}),i&&(0,s.jsx)("img",{src:i,alt:a,className:l,onLoad:()=>d(!1),onError:n}),!i&&!o&&(0,s.jsx)("div",{className:"".concat(l," bg-navy-dark/5 flex items-center justify-center"),children:(0,s.jsx)("div",{className:"text-navy-dark/50",children:"Failed to load"})})]})};function o(){let e=(0,l.useParams)(),t=(0,l.useRouter)(),{data:a}=(0,n.k)(),[o,d]=(0,r.useState)(null),[m,u]=(0,r.useState)(!0),[x,h]=(0,r.useState)([]),[v,b]=(0,r.useState)(""),[y,g]=(0,r.useState)(null),[p,f]=(0,r.useState)(!1),[j,N]=(0,r.useState)(0),w=e.id,k=(0,r.useCallback)(async()=>{u(!0);try{let s=await fetch("/api/gallery?limit=1000"),r=(await s.json()).items.find(e=>e.id===w);if(!r){t.push("/gallery");return}d(r);let l=await fetch("/api/gallery?feature=comments&galleryItemId=".concat(w)),n=await l.json();if(h(n.comments||[]),null==a?void 0:a.user){var e;let t=a.user.id||"dev-user",s=await fetch("/api/gallery?feature=votes&galleryItemId=".concat(w,"&userId=").concat(t)),r=await s.json();g((null===(e=r.vote)||void 0===e?void 0:e.voteType)||null);let l=await fetch("/api/gallery?feature=favorites&userId=".concat(t,"&galleryItemId=").concat(w)),n=await l.json();f(n.isFavorited||!1)}}catch(e){console.error("Failed to fetch item:",e),t.push("/gallery")}finally{u(!1)}},[w,a,t]);(0,r.useEffect)(()=>{w&&k()},[w,k]);let C=async e=>{if((null==a?void 0:a.user)&&o)try{(await fetch("/api/gallery?feature=vote",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({galleryItemId:o.id,userId:a.user.id||"dev-user",voteType:e})})).ok&&(g(t=>t===e?null:e),k())}catch(e){console.error("Failed to vote:",e)}},S=async()=>{if((null==a?void 0:a.user)&&o)try{(await fetch("/api/gallery?feature=favorite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({galleryItemId:o.id,userId:a.user.id||"dev-user"})})).ok&&f(e=>!e)}catch(e){console.error("Failed to favorite:",e)}},I=async()=>{if((null==a?void 0:a.user)&&o&&v.trim())try{if((await fetch("/api/gallery?feature=comment",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({galleryItemId:o.id,userId:a.user.id||"dev-user",userName:a.user.name||"Anonymous Captain",content:v.trim()})})).ok){b("");let e=await fetch("/api/gallery?feature=comments&galleryItemId=".concat(o.id)),t=await e.json();h(t.comments||[])}}catch(e){console.error("Failed to comment:",e)}},P=async()=>{if(!o)return;let e=window.location.href;if(navigator.share)try{await navigator.share({title:o.title,text:o.description,url:e})}catch(t){await navigator.clipboard.writeText(e),alert("Share link copied to clipboard!")}else await navigator.clipboard.writeText(e),alert("Share link copied to clipboard!")},F=e=>new Date(e).toLocaleDateString("en-GB",{day:"2-digit",month:"short",year:"numeric",hour:"2-digit",minute:"2-digit"});return m?(0,s.jsx)("div",{className:"min-h-screen bg-sail-white pt-24 pb-12",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsx)("div",{className:"text-center",children:(0,s.jsx)("div",{className:"text-navy-dark",children:"Loading..."})})})}):o?(0,s.jsx)("div",{className:"min-h-screen bg-sail-white pt-24 pb-12",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:[(0,s.jsx)(i.default,{href:"/gallery",className:"inline-block mb-6 text-brass hover:text-brass-bright transition-colors duration-200",style:{fontFamily:"Cinzel, serif"},children:"← Back to Gallery"}),(0,s.jsxs)("div",{className:"neo-brutal-box p-6 bg-sail-white",children:[(0,s.jsx)("div",{className:"mb-6",children:"collection"===o.type&&o.images?(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsxs)("div",{className:"relative aspect-video bg-navy-dark/10 flex items-center justify-center",children:[o.images.length>1&&(0,s.jsx)("button",{onClick:()=>{N(e=>e>0?e-1:o.images.length-1)},className:"absolute left-4 top-1/2 -translate-y-1/2 z-10 neo-brutal-button bg-brass text-navy-dark w-12 h-12 flex items-center justify-center text-xl shadow-lg hover:bg-brass/80 transition-colors",title:"Previous image",children:"←"}),(0,s.jsx)(c,{src:o.images[j],alt:"".concat(o.title," - Image ").concat(j+1),className:"w-full max-h-96 object-contain mx-auto"}),o.images.length>1&&(0,s.jsx)("button",{onClick:()=>{N(e=>e<o.images.length-1?e+1:0)},className:"absolute right-4 top-1/2 -translate-y-1/2 z-10 neo-brutal-button bg-brass text-navy-dark w-12 h-12 flex items-center justify-center text-xl shadow-lg hover:bg-brass/80 transition-colors",title:"Next image",children:"→"})]}),o.images.length>1&&(0,s.jsxs)("div",{className:"text-center mt-2 text-sm text-navy-dark/70",children:["Image ",j+1," of ",o.images.length]})]}):"image"===o.type?(0,s.jsx)(c,{src:o.url,alt:o.title,className:"w-full max-h-96 object-contain mx-auto"}):(0,s.jsx)("video",{src:o.url,controls:!0,className:"w-full max-h-96 mx-auto"})}),(0,s.jsx)("h1",{className:"text-3xl font-bold text-navy-dark mb-4",style:{fontFamily:"Cinzel, serif"},children:o.title}),(0,s.jsx)("p",{className:"text-navy-dark/70 mb-6",children:o.description}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center justify-between mb-6 text-sm text-navy-dark/60",children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("span",{children:["By ",o.uploader]}),(0,s.jsx)("span",{className:"mx-2",children:"•"}),(0,s.jsx)("span",{children:F(o.createdAt)}),"collection"===o.type&&o.imageCount&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"mx-2",children:"•"}),(0,s.jsxs)("span",{className:"text-brass",children:["\uD83D\uDCF8 ",o.imageCount," images"]})]})]}),(0,s.jsx)("div",{children:(0,s.jsxs)("span",{children:[o.viewCount," views"]})})]}),o.tags.length>0&&(0,s.jsx)("div",{className:"mb-6",children:(0,s.jsx)("div",{className:"flex flex-wrap gap-2",children:o.tags.map((e,t)=>(0,s.jsxs)("span",{className:"neo-brutal-button bg-brass/20 text-navy-dark px-3 py-1 text-sm",children:["#",e]},t))})}),(0,s.jsxs)("div",{className:"flex gap-4 mb-8",children:[a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:()=>C("upvote"),className:"neo-brutal-button px-4 py-2 ".concat("upvote"===y?"bg-green-200 text-green-800":"bg-sail-white text-navy-dark"),children:["▲ ",o.upvotes]}),(0,s.jsxs)("button",{onClick:()=>C("downvote"),className:"neo-brutal-button px-4 py-2 ".concat("downvote"===y?"bg-red-200 text-red-800":"bg-sail-white text-navy-dark"),children:["▼ ",o.downvotes]}),(0,s.jsxs)("button",{onClick:S,className:"neo-brutal-button px-4 py-2 ".concat(p?"bg-red-200 text-red-800":"bg-sail-white text-navy-dark"),children:[p?"❤️":"\uD83E\uDD0D"," Favorite"]})]}),(0,s.jsx)("button",{onClick:P,className:"neo-brutal-button bg-brass text-navy-dark px-4 py-2",children:"Share"})]}),(0,s.jsxs)("div",{className:"border-t border-navy-dark/20 pt-6",children:[(0,s.jsxs)("h2",{className:"text-xl font-semibold text-navy-dark mb-4",style:{fontFamily:"Cinzel, serif"},children:["Comments (",x.length,")"]}),a?(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsx)("textarea",{value:v,onChange:e=>b(e.target.value),placeholder:"Add a comment...",className:"w-full p-3 border-2 border-navy-dark text-navy-dark resize-none",rows:3}),(0,s.jsx)("button",{onClick:I,disabled:!v.trim(),className:"neo-brutal-button bg-brass text-navy-dark px-4 py-2 mt-2 disabled:opacity-50",children:"Post Comment"})]}):(0,s.jsx)("div",{className:"mb-6 p-4 bg-brass/10 border border-brass/20",children:(0,s.jsxs)("p",{className:"text-navy-dark",children:[(0,s.jsx)(i.default,{href:"/gallery",className:"text-brass hover:text-brass-bright",children:"Sign in"})," to leave a comment."]})}),(0,s.jsxs)("div",{className:"space-y-4",children:[x.map(e=>(0,s.jsxs)("div",{className:"bg-sail-white/50 p-4 border border-navy-dark/10",children:[(0,s.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,s.jsx)("span",{className:"font-semibold text-navy-dark",style:{fontFamily:"Cinzel, serif"},children:e.userName}),(0,s.jsx)("span",{className:"text-sm text-navy-dark/60",children:F(e.createdAt)})]}),(0,s.jsx)("p",{className:"text-navy-dark",children:e.content})]},e.id)),0===x.length&&(0,s.jsx)("p",{className:"text-navy-dark/60 text-center py-8",children:"No comments yet. Be the first to share your thoughts!"})]})]})]})]})}):(0,s.jsx)("div",{className:"min-h-screen bg-sail-white pt-24 pb-12",children:(0,s.jsx)("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"text-navy-dark",children:"Item not found"}),(0,s.jsx)(i.default,{href:"/gallery",className:"text-brass hover:text-brass-bright",children:"Back to Gallery"})]})})})}},140:(e,t,a)=>{"use strict";a.d(t,{k:()=>l});var s=a(4785),r=a(7653);function l(){let e=(0,s.kP)(),[t,a]=(0,r.useState)(null);return(0,r.useEffect)(()=>{},[]),e}},7659:(e,t,a)=>{"use strict";a.d(t,{default:()=>r.a});var s=a(5469),r=a.n(s)},7754:(e,t,a)=>{"use strict";var s=a(534);a.o(s,"useParams")&&a.d(t,{useParams:function(){return s.useParams}}),a.o(s,"usePathname")&&a.d(t,{usePathname:function(){return s.usePathname}}),a.o(s,"useRouter")&&a.d(t,{useRouter:function(){return s.useRouter}}),a.o(s,"useSearchParams")&&a.d(t,{useSearchParams:function(){return s.useSearchParams}})}},e=>{var t=t=>e(e.s=t);e.O(0,[4785,5469,1174,8765,1744],()=>t(400)),_N_E=e.O()}]);