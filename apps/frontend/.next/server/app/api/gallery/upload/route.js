(()=>{var e={};e.id=5122,e.ids=[5122],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},5315:e=>{"use strict";e.exports=require("path")},6501:(e,t,a)=>{"use strict";a.r(t),a.d(t,{patchFetch:()=>v,routeModule:()=>g,serverHooks:()=>f,workAsyncStorage:()=>h,workUnitAsyncStorage:()=>w});var r={};a.r(r),a.d(r,{POST:()=>c});var i=a(5122),o=a(7868),s=a(9769),l=a(1929);let n=require("fs/promises");var d=a(5315),p=a.n(d),u=a(6427);let m=e=>({upvotes:0,downvotes:0,viewCount:0,tags:[],...e});async function c(e){try{let t=await e.formData(),a=t.getAll("files"),r=t.get("title"),i=t.get("description"),o=t.get("tags"),s=t.get("uploaderName"),d=t.get("uploaderId");if(!a||0===a.length)return l.NextResponse.json({error:"No files uploaded"},{status:400});if(!r)return l.NextResponse.json({error:"Title is required"},{status:400});let c=[],g=[],h=[],w=[];o&&"string"==typeof o&&(w=o.split(",").map(e=>e.trim()).filter(e=>e.length>0).slice(0,5));let f=s||"Anonymous Captain";s&&!s.toLowerCase().includes("captain")&&(f=`${s}`);for(let e=0;e<a.length;e++){let t=a[e];if(!t)continue;let r=t.type.startsWith("image/"),i=t.type.startsWith("video/");if(!r&&!i)continue;let o=Date.now(),s=Math.random().toString(36).substring(2,15),l=p().extname(t.name),d=`${o}_${s}${l}`,u=await t.arrayBuffer(),m=Buffer.from(u),c=p().join(process.cwd(),"apps/frontend/public/uploads");try{let e=p().join(c,d);await (0,n.writeFile)(e,m)}catch(e){console.error("File write error:",e);continue}let w=`/uploads/${d}`;g.push(w),r&&h.push(w)}if(0===g.length)return l.NextResponse.json({error:"No valid files were uploaded"},{status:400});let v=Date.now();if(h.length>1){let e=m({id:`collection_${v}`,type:"collection",url:h[0],thumbnail:h[0],title:r,description:i||"",uploader:f,uploaderId:d||"dev-user",createdAt:new Date().toISOString(),tags:w,images:h,imageCount:h.length});c.push(e),u.rk.unshift(e)}else for(let e=0;e<g.length;e++){let t=g[e],o=a.find(e=>e&&(e.type.startsWith("image/")||e.type.startsWith("video/")));if(!o)continue;let s=o.type.startsWith("image/"),l=g.length>1?`${r} (${e+1})`:r,n=m({id:`${v}_${e}`,type:s?"image":"video",url:t,thumbnail:t,title:l,description:i||"",uploader:f,uploaderId:d||"dev-user",createdAt:new Date().toISOString(),tags:w,fileSize:o.size,originalFileName:o.name,mimeType:o.type});c.push(n),u.rk.unshift(n)}if(0===c.length)return l.NextResponse.json({error:"No valid files were uploaded"},{status:400});return l.NextResponse.json({message:`Successfully uploaded ${c.length} file(s)`,items:c},{status:201})}catch(e){return console.error("File upload error:",e),l.NextResponse.json({error:"Upload failed. Please try again."},{status:500})}}let g=new i.AppRouteRouteModule({definition:{kind:o.RouteKind.APP_ROUTE,page:"/api/gallery/upload/route",pathname:"/api/gallery/upload",filename:"route",bundlePath:"app/api/gallery/upload/route"},resolvedPagePath:"C:\\Users\\tijer\\OneDrive\\Documents\\krakengaming\\apps\\frontend\\src\\app\\api\\gallery\\upload\\route.ts",nextConfigOutput:"standalone",userland:r}),{workAsyncStorage:h,workUnitAsyncStorage:w,serverHooks:f}=g;function v(){return(0,s.patchFetch)({workAsyncStorage:h,workUnitAsyncStorage:w})}},3245:()=>{},6427:(e,t,a)=>{"use strict";a.d(t,{G_:()=>o,Tn:()=>s,X4:()=>r,gq:()=>n,lB:()=>l,rk:()=>i});let r=e=>({upvotes:Math.floor(20*Math.random()),downvotes:Math.floor(3*Math.random()),viewCount:Math.floor(500*Math.random())+50,tags:[],...e}),i=[r({id:"1",type:"image",url:"https://www.directart.co.uk/mall/images/800s/dhm1519.jpg",thumbnail:"https://www.directart.co.uk/mall/images/800s/dhm1519.jpg",title:"The Battle of Trafalgar",description:"The decisive naval engagement that broke the combined French and Spanish fleets, securing British naval supremacy",uploader:"Admiral Nelson",uploaderId:"demo1",createdAt:new Date("2024-06-20T10:30:00Z").toISOString(),tags:["naval-battle","trafalgar","nelson","historic"],upvotes:15,downvotes:2,viewCount:324}),r({id:"2",type:"image",url:"https://www.directart.co.uk/mall/images/800s/dhm6802pc.jpg",thumbnail:"https://www.directart.co.uk/mall/images/800s/dhm6802pc.jpg",title:"Ships of the Line in Formation",description:"Majestic warships maintaining battle formation, displaying the power and discipline of the Royal Navy",uploader:"Captain Blackwood",uploaderId:"demo2",createdAt:new Date("2024-06-21T14:15:00Z").toISOString(),tags:["ships","formation","royal-navy","tactics"],upvotes:8,downvotes:1,viewCount:156}),r({id:"3",type:"image",url:"https://www.directart.co.uk/mall/images/800s/dhm1165.jpg",thumbnail:"https://www.directart.co.uk/mall/images/800s/dhm1165.jpg",title:"Naval Battle in Stormy Seas",description:"Ships engaging in fierce combat amidst turbulent waters, showcasing the courage of sailors in battle",uploader:"Captain Hardy",uploaderId:"demo3",createdAt:new Date("2024-06-21T16:45:00Z").toISOString(),tags:["storm","battle","courage","naval-combat"],upvotes:12,downvotes:0,viewCount:289}),r({id:"4",type:"image",url:"https://www.directart.co.uk/mall/images/800s/dhm0150.jpg",thumbnail:"https://www.directart.co.uk/mall/images/800s/dhm0150.jpg",title:"Victory at Sea",description:"A triumphant moment as British ships claim victory over enemy vessels in the age of wooden walls",uploader:"Admiral Collingwood",uploaderId:"demo4",createdAt:new Date("2024-06-22T09:20:00Z").toISOString(),tags:["victory","triumph","british-navy"]}),r({id:"5",type:"image",url:"https://www.directart.co.uk/mall/images/800s/dhm0515.jpg",thumbnail:"https://www.directart.co.uk/mall/images/800s/dhm0515.jpg",title:"Fleet Engagement",description:"Multiple ships of the line engaging in a grand naval battle, with cannon smoke filling the horizon",uploader:"Captain Troubridge",uploaderId:"demo5",createdAt:new Date("2024-06-22T11:30:00Z").toISOString(),tags:["fleet","engagement","cannons","smoke"]}),r({id:"collection_demo",type:"collection",url:"https://www.directart.co.uk/mall/images/800s/dhm1519.jpg",thumbnail:"https://www.directart.co.uk/mall/images/800s/dhm1519.jpg",title:"Epic Naval Battle Collection",description:"A collection of dramatic naval battle scenes showcasing the power and glory of maritime warfare",uploader:"Admiral Collection",uploaderId:"demo6",createdAt:new Date("2024-06-23T12:00:00Z").toISOString(),tags:["collection","naval-battles","epic","maritime"],images:["https://www.directart.co.uk/mall/images/800s/dhm1519.jpg","https://www.directart.co.uk/mall/images/800s/dhm6802pc.jpg","https://www.directart.co.uk/mall/images/800s/dhm1165.jpg","https://www.directart.co.uk/mall/images/800s/dhm0150.jpg"],imageCount:4,upvotes:25,downvotes:1,viewCount:450})],o=[],s=[],l=[],n=[]}};var t=require("../../../../webpack-runtime.js");t.C(e);var a=e=>t(t.s=e),r=t.X(0,[9769,4999],()=>a(6501));module.exports=r})();