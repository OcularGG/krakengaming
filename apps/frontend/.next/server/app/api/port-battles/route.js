(()=>{var e={};e.id=10,e.ids=[10],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},209:e=>{"use strict";e.exports=require("next/dist/server/app-render/action-async-storage.external.js")},9348:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},412:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},4770:e=>{"use strict";e.exports=require("crypto")},2254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},7261:e=>{"use strict";e.exports=require("node:util")},116:(e,t,r)=>{"use strict";r.r(t),r.d(t,{patchFetch:()=>U,routeModule:()=>T,serverHooks:()=>A,workAsyncStorage:()=>w,workUnitAsyncStorage:()=>C});var s={};r.r(s),r.d(s,{DELETE:()=>j,GET:()=>h,POST:()=>v,PUT:()=>b});var n=r(5122),a=r(7868),o=r(9769),i=r(1929),d=r(6152);let p=["1207434980855259206"],l=[],u=[],c=[],m=1,f=1,g=1,x=1,I=1,S=1,y=()=>{0===l.length&&(l=[{id:"pb-1",portName:"Havana",serverMeetupTime:"2025-06-30T18:00:00.000Z",serverBattleStartTime:"2025-06-30T19:00:00.000Z",waterType:"Deep Water",meetupLocation:"Havana Port",pbCommanderName:"Admiral Nelson",secondICCommanderName:"Captain Hardy",reqCommanderName:"Captain Pellew",totalBRLimit:2500,createdBy:"1207434980855259206",activeFleetId:"fleet-main-1",status:"active",createdAt:"2025-06-24T10:00:00.000Z"},{id:"pb-2",portName:"Cartagena",serverMeetupTime:"2025-07-02T17:30:00.000Z",serverBattleStartTime:"2025-07-02T18:30:00.000Z",waterType:"Shallow Water",meetupLocation:"Cartagena Port",pbCommanderName:"Admiral Collingwood",secondICCommanderName:"Captain Troubridge",reqCommanderName:"Captain Fremantle",totalBRLimit:2e3,createdBy:"1207434980855259206",activeFleetId:"fleet-main-2",status:"active",createdAt:"2025-06-26T10:00:00.000Z"}],u=[{id:"fleet-main-1",portBattleId:"pb-1",name:"Main Fleet",type:"main",roles:[{id:"role-1",fleetId:"fleet-main-1",name:"Main Line DPS",expectedShip:"Victory",position:1,signUp:{id:"signup-1",roleId:"role-1",userId:"player-1",userName:"Captain Smith",clan:"CLAN1",captainName:"Captain Smith",comments:"Ready for battle!",ship:"Victory",books:5,alternateShip:"Bellona",alternateBooks:4,willingToScreen:!0,status:"approved",submittedAt:"2025-06-25T10:00:00.000Z",approvedAt:"2025-06-25T11:00:00.000Z",approvedBy:"1207434980855259206"}},{id:"role-2",fleetId:"fleet-main-1",name:"Support Line",expectedShip:"Bellona",position:2},{id:"role-3",fleetId:"fleet-main-1",name:"Escort Frigate",expectedShip:"Endymion",position:3},{id:"role-4",fleetId:"fleet-main-1",name:"Scout",expectedShip:"Diana",position:4},{id:"role-5",fleetId:"fleet-main-1",name:"Reserve Line",expectedShip:"3rd Rate (74)",position:5}],createdAt:"2025-06-24T10:00:00.000Z"},{id:"fleet-alt1-1",portBattleId:"pb-1",name:"Alternate Fleet 1",type:"alternate1",roles:[{id:"role-alt1-1",fleetId:"fleet-alt1-1",name:"Heavy Line",expectedShip:"Santisima",position:1},{id:"role-alt1-2",fleetId:"fleet-alt1-1",name:"Support",expectedShip:"Bucentaure",position:2},{id:"role-alt1-3",fleetId:"fleet-alt1-1",name:"Frigate Screen",expectedShip:"Trincomalee",position:3}],createdAt:"2025-06-24T10:00:00.000Z"},{id:"fleet-main-2",portBattleId:"pb-2",name:"Main Fleet",type:"main",roles:[{id:"role-2-1",fleetId:"fleet-main-2",name:"Line Ship",expectedShip:"Christian VII",position:1},{id:"role-2-2",fleetId:"fleet-main-2",name:"Support",expectedShip:"Wasa",position:2},{id:"role-2-3",fleetId:"fleet-main-2",name:"Frigate",expectedShip:"L'Hermione",position:3},{id:"role-2-4",fleetId:"fleet-main-2",name:"Fast Scout",expectedShip:"Mercury",position:4}],createdAt:"2025-06-26T10:00:00.000Z"}],c=[{id:"standby-1",portBattleId:"pb-1",userId:"player-3",userName:"Captain Brown",clan:"CLAN3",captainName:"Captain Brown",comments:"Happy to help if needed",ship:"Agamemnon",books:4,alternateShip:"Bellona",alternateBooks:3,willingToScreen:!0,submittedAt:"2025-06-25T12:00:00.000Z"}])},N=e=>e&&p.includes(e),R=e=>{switch(e){case"pb":return`pb-${m++}`;case"signup":return`signup-${f++}`;case"standby":return`standby-${g++}`;case"screening":return`screening-${x++}`;case"role":return`role-${I++}`;case"fleet":return`fleet-${S++}`;default:return`${e}-${Math.random().toString(36).substr(2,9)}`}};async function h(e){try{y();let{searchParams:t}=new URL(e.url),r=t.get("pbId"),s="true"===t.get("includeFleets"),n="true"===t.get("includeStandby");if(r){let e=l.find(e=>e.id===r);if(!e)return i.NextResponse.json({error:"Port battle not found"},{status:404});let t={...e};return s&&(t.fleetCompositions=u.filter(e=>e.portBattleId===r)),n&&(t.standbySignUps=c.filter(e=>e.portBattleId===r)),i.NextResponse.json(t)}let a={portBattles:l};return s&&(a.fleetCompositions=u),n&&(a.standbySignUps=c),i.NextResponse.json(a)}catch(e){return console.error("Error fetching port battles:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function v(e){try{let t=await (0,d.I8)();if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{action:r,...s}=await e.json();switch(y(),r){case"create_port_battle":{if(!N(t.user.id))return i.NextResponse.json({error:"Admin access required"},{status:403});let e={id:R("pb"),...s,createdBy:t.user.id,activeFleetId:"",status:"active",createdAt:new Date().toISOString()};l.push(e);let r={id:R("fleet"),portBattleId:e.id,name:"Main Fleet",type:"main",roles:s.mainFleetRoles.map((e,t)=>({id:R("role"),fleetId:R("fleet"),name:e.name,expectedShip:e.expectedShip,position:t+1})),createdAt:new Date().toISOString()};return u.push(r),e.activeFleetId=r.id,i.NextResponse.json({portBattle:e,fleetComposition:r},{status:201})}case"sign_up":{let e=u.flatMap(e=>e.roles).find(e=>e.id===s.roleId);if(!e)return i.NextResponse.json({error:"Role not found"},{status:404});if(e.signUp)return i.NextResponse.json({error:"Role already filled"},{status:400});let r={id:R("signup"),...s,userId:t.user.id,userName:t.user.name||"Unknown",status:"pending",submittedAt:new Date().toISOString()};return e.signUp=r,i.NextResponse.json(r,{status:201})}case"standby_sign_up":{if(!l.find(e=>e.id===s.portBattleId))return i.NextResponse.json({error:"Port battle not found"},{status:404});let e={id:R("standby"),...s,userId:t.user.id,userName:t.user.name||"Unknown",submittedAt:new Date().toISOString()};return c.push(e),i.NextResponse.json(e,{status:201})}default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Error in POST:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function b(e){try{let t=await (0,d.I8)();if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{action:r,...s}=await e.json();switch(y(),r){case"approve_signup":{if(!N(t.user.id))return i.NextResponse.json({error:"Admin access required"},{status:403});let{roleId:e,status:r}=s,n=u.flatMap(e=>e.roles).find(t=>t.id===e);if(!n||!n.signUp)return i.NextResponse.json({error:"Sign up not found"},{status:404});return n.signUp.status=r,"approved"===r&&(n.signUp.approvedAt=new Date().toISOString(),n.signUp.approvedBy=t.user.id),i.NextResponse.json({message:"Sign up updated successfully"})}case"assign_role":{if(!N(t.user.id))return i.NextResponse.json({error:"Admin access required"},{status:403});let{fromRoleId:e,toRoleId:r}=s,n=u.flatMap(e=>e.roles).find(t=>t.id===e),a=u.flatMap(e=>e.roles).find(e=>e.id===r);if(!n||!a||!n.signUp)return i.NextResponse.json({error:"Invalid role assignment"},{status:400});if(a.signUp)return i.NextResponse.json({error:"Target role already filled"},{status:400});return a.signUp={...n.signUp,roleId:r},n.signUp=void 0,i.NextResponse.json({message:"Role reassigned successfully"})}default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Error in PUT:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}async function j(e){try{let t=await (0,d.I8)();if(!t?.user?.id)return i.NextResponse.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),s=r.get("action"),n=r.get("id");switch(y(),s){case"delete_port_battle":{if(!N(t.user.id))return i.NextResponse.json({error:"Admin access required"},{status:403});let e=l.findIndex(e=>e.id===n);if(-1===e)return i.NextResponse.json({error:"Port battle not found"},{status:404});return l.splice(e,1),u=u.filter(e=>e.portBattleId!==n),c=c.filter(e=>e.portBattleId!==n),i.NextResponse.json({message:"Port battle deleted successfully"})}case"delete_signup":{let e=r.get("roleId"),s=u.flatMap(e=>e.roles).find(t=>t.id===e);if(!s||!s.signUp)return i.NextResponse.json({error:"Sign up not found"},{status:404});if(s.signUp.userId!==t.user.id&&!N(t.user.id))return i.NextResponse.json({error:"Access denied"},{status:403});return s.signUp=void 0,i.NextResponse.json({message:"Sign up deleted successfully"})}case"delete_standby":{let e=c.findIndex(e=>e.id===n);if(-1===e)return i.NextResponse.json({error:"Standby sign up not found"},{status:404});if(c[e].userId!==t.user.id&&!N(t.user.id))return i.NextResponse.json({error:"Access denied"},{status:403});return c.splice(e,1),i.NextResponse.json({message:"Standby sign up deleted successfully"})}default:return i.NextResponse.json({error:"Invalid action"},{status:400})}}catch(e){return console.error("Error in DELETE:",e),i.NextResponse.json({error:"Internal server error"},{status:500})}}let T=new n.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/port-battles/route",pathname:"/api/port-battles",filename:"route",bundlePath:"app/api/port-battles/route"},resolvedPagePath:"C:\\Users\\tijer\\OneDrive\\Documents\\krakengaming\\apps\\frontend\\src\\app\\api\\port-battles\\route.ts",nextConfigOutput:"standalone",userland:s}),{workAsyncStorage:w,workUnitAsyncStorage:C,serverHooks:A}=T;function U(){return(0,o.patchFetch)({workAsyncStorage:w,workUnitAsyncStorage:C})}},3245:()=>{},6152:(e,t,r)=>{"use strict";r.d(t,{I8:()=>d,handlers:()=>a});var s=r(7708),n=r(1185);let{handlers:a,signIn:o,signOut:i,auth:d}=(0,s.ZP)({providers:[(0,n.Z)({clientId:process.env.DISCORD_CLIENT_ID,clientSecret:process.env.DISCORD_CLIENT_SECRET})],secret:process.env.NEXTAUTH_SECRET,callbacks:{jwt:async({token:e,account:t,profile:r})=>(t&&r&&(e.accessToken=t.access_token,e.discordId=r.id,e.username=r.username,e.discriminator=r.discriminator),e),session:async({session:e,token:t})=>(t&&e.user&&(e.accessToken=t.accessToken,e.user.discordId=t.discordId,e.user.username=t.username,e.user.discriminator=t.discriminator),e)},pages:{error:"/auth/error"},debug:!1})}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[9769,4999,7478],()=>r(116));module.exports=s})();